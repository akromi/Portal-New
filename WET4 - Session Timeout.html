{%- assign path = request.path | downcase -%}
{%- if path contains '/session-timeout' -%}
{%- comment -%}
// sessto disabled on this page.
{%- endcomment -%}
{%- else -%}
{%- comment -%}
// sess to enabled on this page.
{%- endcomment -%}
{%- assign isAuthenticated = false -%}
{%- assign lang = website.selected_language.code | downcase -%}
{%- if isAuthenticated -%}
<span class="wb-sessto" data-wb-sessto='{
    "inactivity": 600000,
    "reactionTime": 180000,
    "sessionalive": 600000,
    "refreshCallbackUrl": "/alive",
    "logouturl": "/account/login/logoff",
    "signInUrl": "/SignIn?returnUrl=%2F"
  }'></span>
{%- else -%}
<span class="wb-sessto" data-wb-sessto='{
  "inactivity": 600000,
  "reactionTime": 180000,
  "sessionalive": 600000,
  "logouturl": "/session-timeout",
  "textOverrides": {
    {% if lang == "fr" %}
    "buttonContinue": "Continuer",
    "buttonEnd": "Terminer et quitter",
    "buttonSignin": "Revenir au début",
    "timeoutEnd": "Vous êtes inactif depuis un moment.",
    "timeoutAlready": "Cette session est terminée. Vous pouvez recommencer."
    {% else %}
    "buttonContinue": "Keep browsing",
    "buttonEnd": "End and leave",
    "buttonSignin": "Return to start",
    "timeoutEnd": "You’ve been inactive for a while.",
    "timeoutAlready": "This session has ended. You can start over."
    {% endif %}
  }
}'></span>
{%- endif -%}
<script>
  // Don’t rewrite on the timeout page itself
  if (!/\/session-?timeout\/?$/i.test(location.pathname)) {
    var el = document.querySelector('.wb-sessto');
    if (el) {
      try {
        var cfg = JSON.parse(el.getAttribute('data-wb-sessto') || '{}');
        var here = location.pathname + location.search + location.hash;
        cfg.logouturl = '/session-timeout?returnUrl=' + encodeURIComponent(here);
        el.setAttribute('data-wb-sessto', JSON.stringify(cfg));
      } catch (e) {
        console.warn('sessto config parse failed:', e);
      }
    }
  }
</script>
<script>
  (window.jQuery || window.$wet)(document).one("wb-ready.wb", function () {
    (window.jQuery || window.$wet)(".wb-sessto").trigger("wb-init.wb-sessto");
  });
  (window.jQuery || window.$wet)(document).on("wb-ready.wb-sessto", () => console.log("[sessto] ready"));
  (window.jQuery || window.$wet)(document).on("timeout.wb-sessto", () => console.log("[sessto] timeout"));
</script>
{%- endif -%}
