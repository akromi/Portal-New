{%- assign path = request.path | downcase -%}
{%- if path contains '/session-timeout' -%}
{%- comment -%}
// sessto disabled on this page.
{%- endcomment -%}
{%- else -%}
{%- comment -%}
// sess to enabled on this page.
{%- endcomment -%}
{%- assign isAuthenticated = false -%}
{%- assign lang = website.selected_language.code | downcase -%}
{%- if isAuthenticated -%}
<span class="wb-sessto" data-wb-sessto='{
    "inactivity": 600000,
    "reactionTime": 180000,
    "sessionalive": 600000,
    "refreshCallbackUrl": "/alive",
    "logouturl": "/account/login/logoff",
    "signInUrl": "/SignIn?returnUrl=%2F"
  }'></span>
{%- else -%}
<span class="wb-sessto" data-wb-sessto='{
  "inactivity": 600000,
  "reactionTime": 180000,
  "sessionalive": 600000,
  "logouturl": "/session-timeout",
  "textOverrides": {
    {% if lang == "fr" %}
    "buttonContinue": "Continuer",
    "buttonEnd": "Terminer et quitter",
    "buttonSignin": "Revenir au début",
    "timeoutEnd": "Vous êtes inactif depuis un moment.",
    "timeoutAlready": "Cette session est terminée. Vous pouvez recommencer."
    {% else %}
    "buttonContinue": "Keep browsing",
    "buttonEnd": "End and leave",
    "buttonSignin": "Return to start",
    "timeoutEnd": "You’ve been inactive for a while.",
    "timeoutAlready": "This session has ended. You can start over."
    {% endif %}
  }
}'></span>
{%- endif -%}
<script>
  (function () {
    if (/\/session-?timeout\/?$/i.test(location.pathname)) {
      return;
    }

    var sesstoEl = document.querySelector(".wb-sessto");
    if (!sesstoEl) {
      return;
    }

    var cfg;
    try {
      cfg = JSON.parse(sesstoEl.getAttribute("data-wb-sessto") || "{}");
    } catch (err) {
      return;
    }

    var currentUrl = location.pathname + location.search + location.hash;
    cfg.logouturl = "/session-timeout?returnUrl=" + encodeURIComponent(currentUrl);
    sesstoEl.setAttribute("data-wb-sessto", JSON.stringify(cfg));
  })();
</script>
<script>
  (function (jq) {
    if (!jq) {
      return;
    }

    var $sessto = jq(".wb-sessto");
    if (!$sessto.length) {
      return;
    }

    jq(document).one("wb-ready.wb", function () {
      $sessto.trigger("wb-init.wb-sessto");
    });
  })(window.jQuery || window.$wet);
</script>
{%- endif -%}
